<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CV Dashboard – Portfolio (Offline)</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <nav>
    <div class="logo"><strong>Dein Name</strong> <span class="badge">CV</span></div>
    <div class="nav-links">
      <button id="btn-export">Export</button>
      <button id="btn-import">Import</button>
      <button id="btn-public">Public CV View</button>
      <button id="btn-tests">Validations</button>
      <input type="file" id="file-import" class="hidden" accept=".json,.jsonl,application/json,text/plain" multiple />
    </div>
  </nav>

  <div class="container">
    <h1 style="margin-bottom:0.75rem;">Persönliches Portfolio (Offline‑first)</h1>
    <p class="small">Daten liegen in <strong>IndexedDB</strong>. Geld in Minor Units (Integer), Mengen in Micro‑Units. Bewertung wählbar (FIFO/LIFO). FX via separater Zeitreihe (Basis: EUR).</p>

    <div class="controls">
      <label>Bewertungsmethode:
        <select id="valuation-method">
          <option value="fifo" selected>FIFO</option>
          <option value="lifo">LIFO</option>
        </select>
      </label>
      <label>Basiswährung: <input id="base-currency" value="EUR" size="4" /></label>
    </div>

    <div class="dashboard" id="app-sections">
      <!-- Stocks: Master + List -->
      <section class="module" id="module-stocks">
        <h2 class="section-title">Stocks</h2>
        <div class="controls">
          <input id="stock-wkn" placeholder="WKN (z. B. 851399)" />
          <input id="stock-name" placeholder="Name (z. B. Amazon)" />
          <input id="stock-exchange" placeholder="Börse (z. B. XETRA)" />
          <select id="stock-currency" title="Währung">
            <option value="EUR" selected>EUR</option>
            <option value="USD">USD</option>
            <option value="CHF">CHF</option>
            <option value="GBP">GBP</option>
            <option value="JPY">JPY</option>
          </select>
          <button class="primary" id="add-stock">Stock anlegen</button>
        </div>

        <table style="margin-top:0.75rem;">
          <thead>
            <tr>
              <th>WKN</th>
              <th>Name</th>
              <th>Bestand</th>
              <th>Ø Einstand</th>
              <th>Aktuell</th>
              <th>P&L</th>
              <th>Aktion</th>
            </tr>
          </thead>
          <tbody id="stocks-tbody"></tbody>
        </table>
      </section>

      <!-- Transactions -->
      <section class="module" id="module-transactions">
        <h2 class="section-title">Transaktionen</h2>
        <div class="controls row">
          <input id="tx-wkn" placeholder="WKN" />
          <select id="tx-type">
            <option value="buy">buy</option>
            <option value="sell">sell</option>
            <option value="dividend">dividend</option>
            <option value="fee">fee</option>
            <option value="split">split</option>
          </select>
          <input id="tx-qty" placeholder="Menge (z. B. 3.5)" />
          <input id="tx-price" placeholder="Preis pro Stück (z. B. 120.40)" />
          <input id="tx-curr" placeholder="Währung (z. B. EUR)" />
          <input id="tx-ts" type="datetime-local" />
          <button class="primary" id="add-tx">Buchen</button>
        </div>

        <table style="margin-top:0.75rem;">
          <thead>
            <tr>
              <th>WKN</th>
              <th>Typ</th>
              <th>Menge</th>
              <th>Preis</th>
              <th>Währung</th>
              <th>Zeit</th>
            </tr>
          </thead>
          <tbody id="tx-tbody"></tbody>
        </table>
      </section>

      <!-- Quotes & Charts -->
      <section class="module" id="module-quotes">
        <h2 class="section-title">Quotes / Preise</h2>
        <div class="controls">
          <input id="q-wkn" placeholder="WKN" />
          <input id="q-date" type="date" />
          <input id="q-price" placeholder="Schlusskurs (z. B. 123.45)" />
          <input id="q-currency" placeholder="Währung (EUR)" />
          <button class="primary" id="add-quote">Quote speichern</button>
          <label class="small">oder JSONL importieren: <input type="file" id="quotes-import" accept=".jsonl,.txt" /></label>
        </div>

        <div class="controls">
          <select id="chart-wkn"></select>
          <button id="btn-chart">Kursverlauf anzeigen</button>
        </div>
        <canvas id="stockChart" width="400" height="200"></canvas>
      </section>

      <!-- FX Rates -->
      <section class="module" id="module-fx">
        <h2 class="section-title">FX‑Zeitreihe (→ EUR)</h2>
        <div class="controls">
          <input id="fx-currency" placeholder="Währung (z. B. USD)" />
          <input id="fx-date" type="date" />
          <input id="fx-rate" placeholder="Rate: 1 CUR = ? EUR (z. B. 0.92)" />
          <button class="primary" id="add-fx">FX speichern</button>
          <label class="small">JSONL importieren: <input type="file" id="fx-import" accept=".jsonl,.txt" /></label>
        </div>
        <p class="small">Speicherformat (JSONL): {"currency":"USD","date":"2025-09-01","rate_to_eur":0.92}</p>
      </section>

      <!-- Allocation & Total -->
      <section class="module" id="module-allocation">
        <h2 class="section-title">Portfolio Allocation</h2>
        <canvas id="pieChart" width="300" height="300"></canvas>
      </section>

      <section class="module" id="module-total">
        <h2 class="section-title">Gesamtvermögen</h2>
        <p id="total-value" class="percent-change"></p>
        <p id="total-change" class="small"></p>
        <canvas id="totalChart" width="300" height="150"></canvas>
      </section>
    </div>

    <!-- Public, anonymisierte CV-Ansicht -->
    <section class="module hidden" id="module-public">
      <h2 class="section-title">Public CV View (anonymisiert)</h2>
      <p class="small">Zeigt nur Aggregationen (keine WKN/Name). Zum Einbetten in die CV‑Seite geeignet.</p>
      <div class="dashboard">
        <section class="module">
          <h3>Überblick</h3>
          <p id="pub-total" class="percent-change"></p>
          <p id="pub-meta" class="small"></p>
        </section>
        <section class="module">
          <h3>Allocation</h3>
          <canvas id="pubPie" width="300" height="300"></canvas>
        </section>
      </div>
    </section>

    <!-- Validations / Tests -->
    <section class="module hidden" id="module-tests">
      <h2 class="section-title">Validations & Selbsttests</h2>
      <div class="controls">
        <button class="primary" id="run-tests">Run checks</button>
      </div>
      <pre class="log" id="test-output"></pre>
    </section>
  </div>

  <footer>© 2025 Dein Name. Privat. Keine Server-Calls.</footer>
  <script src="dashboard.js"></script>
</body>
</html>
